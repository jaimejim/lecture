<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DDOS using CoAP - Lectures</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><a href="ietf.html"><strong aria-hidden="true">2.</strong> The IETF</a></li><li><a href="coap.html"><strong aria-hidden="true">3.</strong> CoAP</a></li><li><ol class="section"><li><a href="coapmessage.html"><strong aria-hidden="true">3.1.</strong> A CoAP Message</a></li><li><a href="coaplinks.html"><strong aria-hidden="true">3.2.</strong> CoAP Web Linking and Serialization</a></li><li><a href="coapdiscovery.html"><strong aria-hidden="true">3.3.</strong> Finding your CoAP devices</a></li></ol></li><li><a href="udpddos.html"><strong aria-hidden="true">4.</strong> On DDOS Attacks</a></li><li><ol class="section"><li><a href="coapddos.html" class="active"><strong aria-hidden="true">4.1.</strong> DDOS using CoAP</a></li></ol></li><li><a href="reading.html"><strong aria-hidden="true">5.</strong> Relevant Articles</a></li><li><ol class="section"><li><a href="10years.html"><strong aria-hidden="true">5.1.</strong> A decade of Internet Evolution</a></li><li><a href="another10years.html"><strong aria-hidden="true">5.2.</strong> Another 10 years</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Lectures</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#ddos-using-coap" id="ddos-using-coap"><h1>DDOS using CoAP</h1></a>
<p>That CoAP can be used in malicious DDOS attacks is news but at the same time it isn't. Already when the CoAP RFC was publish it came with a <a href="https://tools.ietf.org/html/rfc7252#section-11">Security Section</a> with that caveat in mind, being UDP a choice made to process message faster and scale better. Today, CoAP is now deployed widely enough to be more than noticeable by malicious attackers.</p>
<p>As CoAP becomes more mainstream, it is likely that there will be more attacks taking advantage of misconfigured endpoints. In fact CoAP has already been <em>&quot;occasionally used as a basis of DDOS attacks, with increasing frequency, reaching <a href="https://www.zdnet.com/article/the-coap-protocol-is-the-next-big-thing-for-ddos-attacks/">55Gbps on average</a>, and with the largest one clocking at 320Gbps&quot;</em>. That is pretty large already, since as we saw <a href="./udpddos.html">On DDOS Attacks</a> Mirai clocked at 320Gbps. It is thus likely that a 1Tb attack using CoAP will occur soon. Apparently the attacks are short-lived, lasting on average <em>&quot;just over <a href="https://www.securityweek.com/attackers-use-coap-ddos-amplification">90 seconds</a>&quot;</em> and feature around 100 packets per second.</p>
<p>As a danish researcher at <a href="https://www.youtube.com/watch?v=DX68vb2XjdQ&amp;feature=youtu.be&amp;t=19m28s">RVAsec</a> points out, <em>the CoAP protocol was not yet mainstream back in 2017, but the number of visible CoAP endpoints has increased rapidly from about <code>6500</code> to <code>220000</code> between november 2017 and may 2018, to more than <code>738041</code> in October 2018</em>.</p>
<p>That number has decreased as devices are being patched and today we would find about <code>436854</code> running <code>shodan count port:5683</code>, out of which <code>305051</code> are in China. There are of course orders of magnitude more endpoints that are not openly visible on the Internet.</p>
<p>These attacks are based on the two vulnerabilities of UDP-based protocols mentioned in the <a href="./udpddos.html">previous section</a>:</p>
<p>## IP Address Spoofing</p>
<p><a href="https://tools.ietf.org/html/rfc7252#section-11.4">RFC7252 Section 11.4</a></p>
<p>Due to the lack of a handshake in UDP, a rogue endpoint that is free
to read and write messages carried by the constrained network (i.e.,
NoSec or PreSharedKey deployments with a nodes/key ratio &gt; 1:1), may
easily attack a single endpoint, a group of endpoints, as well as the
whole network, e.g., by:</p>
<ol>
<li>
<p>spoofing a Reset message in response to a Confirmable message or
Non-confirmable message, thus making an endpoint &quot;deaf&quot;; or</p>
</li>
<li>
<p>spoofing an ACK in response to a CON message, thus potentially
preventing the sender of the CON message from retransmitting, and
drowning out the actual response; or</p>
</li>
<li>
<p>spoofing the entire response with forged payload/options (this
has different levels of impact: from single-response disruption,
to much bolder attacks on the supporting infrastructure, e.g.,
poisoning proxy caches, or tricking validation/lookup interfaces
in resource directories and, more generally, any component that
stores global network state and uses CoAP as the messaging
facility to handle setting or updating state is a potential
target.); or</p>
</li>
<li>
<p>spoofing a multicast request for a target node; this may result
in network congestion/collapse, a DoS attack on the victim, or
forced wake-up from sleeping; or</p>
</li>
<li>
<p>spoofing observe messages, etc.</p>
</li>
</ol>
<p>Response spoofing by off-path attackers can be detected and mitigated
even without transport layer security by choosing a nontrivial,
randomized token in the request (Section 5.3.1).  [RFC4086] discusses
randomness requirements for security.</p>
<p>In principle, other kinds of spoofing can be detected by CoAP only in
case Confirmable message semantics is used, because of unexpected
Acknowledgement or Reset messages coming from the deceived endpoint.
But this imposes keeping track of the used Message IDs, which is not
always possible, and moreover detection becomes available usually
after the damage is already done.  This kind of attack can be
prevented using security modes other than NoSec.</p>
<p>With or without source address spoofing, a client can attempt to
overload a server by sending requests, preferably complex ones, to a
server; address spoofing makes tracing back, and blocking, this
attack harder.  Given that the cost of a CON request is small, this
attack can easily be executed.  Under this attack, a constrained node
with limited total energy available may exhaust that energy much more
quickly than planned (battery depletion attack).  Also, if the client
uses a Confirmable message and the server responds with a Confirmable
separate response to a (possibly spoofed) address that does not
respond, the server will have to allocate buffer and retransmission
logic for each response up to the exhaustion of MAX_TRANSMIT_SPAN,
making it more likely that it runs out of resources for processing
legitimate traffic.  The latter problem can be mitigated somewhat by
limiting the rate of responses as discussed in Section 4.7.  An
attacker could also spoof the address of a legitimate client; this
might cause the server, if it uses separate responses, to block
legitimate responses to that client because of NSTART=1.  All these
attacks can be prevented using a security mode other than NoSec, thus
leaving only attacks on the security protocol.</p>
<a class="header" href="#amplification" id="amplification"><h2>Amplification</h2></a>
<p>As it is explained on RFC7252.<a href="https://tools.ietf.org/html/rfc7252#section-11.3">11.3</a></p>
<p>CoAP servers generally reply to a request packet with a response
packet.  This response packet may be significantly larger than the
request packet.  An attacker might use CoAP nodes to turn a small
attack packet into a larger attack packet, an approach known as
amplification.  There is therefore a danger that CoAP nodes could
become implicated in denial-of-service (DoS) attacks by using the
amplifying properties of the protocol: an attacker that is attempting
to overload a victim but is limited in the amount of traffic it can
generate can use amplification to generate a larger amount of
traffic.</p>
<p>This is particularly a problem in nodes that enable NoSec access, are
accessible from an attacker, and can access potential victims (e.g.,
on the general Internet), as the UDP protocol provides no way to
verify the source address given in the request packet.  An attacker
need only place the IP address of the victim in the source address of
a suitable request packet to generate a larger packet directed at the
victim.</p>
<p>As a mitigating factor, many constrained networks will only be able
to generate a small amount of traffic, which may make CoAP nodes less
attractive for this attack.  However, the limited capacity of the
constrained network makes the network itself a likely victim of an
amplification attack.</p>
<p>Therefore, large amplification factors SHOULD NOT be provided in the
response if the request is not authenticated.  A CoAP server can
reduce the amount of amplification it provides to an attacker by
using slicing/blocking modes of CoAP [BLOCK] and offering large
resource representations only in relatively small slices.  For
example, for a 1000-byte resource, a 10-byte request might result in
an 80-byte response (with a 64-byte block) instead of a 1016-byte
response, considerably reducing the amplification provided.</p>
<p>CoAP also supports the use of multicast IP addresses in requests, an
important requirement for M2M.  Multicast CoAP requests may be the
source of accidental or deliberate DoS attacks, especially over
constrained networks.  This specification attempts to reduce the
amplification effects of multicast requests by limiting when a
response is returned.  To limit the possibility of malicious use,
CoAP servers SHOULD NOT accept multicast requests that can not be
authenticated in some way, cryptographically or by some multicast
boundary limiting the potential sources.  If possible, a CoAP server
SHOULD limit the support for multicast requests to the specific
resources where the feature is required.</p>
<p>On some general-purpose operating systems providing a POSIX-style API
[IEEE1003.1], it is not straightforward to find out whether a packet
received was addressed to a multicast address.  While many
implementations will know whether they have joined a multicast group,
this creates a problem for packets addressed to multicast addresses
of the form FF0x::1, which are received by every IPv6 node.
Implementations SHOULD make use of modern APIs such as
IPV6_RECVPKTINFO [RFC3542], if available, to make this determination.</p>
<p>## Avoid NoSec</p>
<p>uct at the cheapest possible price point. It may be disconcerting to realise that the web camera you just installed has a security model that can be summarised with the phrase: “no security at all”, and its actually offering a view of your house to the entire Internet. It may be slightly more disconcerting to realise that your electronic wallet is on a device that is using a massive compilation of open source software of largely unknown origin, with a security model that is not completely understood, but appears to be susceptible to be coerced into being a “yes, take all you want”.</p>
<p>Distributed Denial of Service (DDoS) attacks are a common way to prevent Internet Services from running.  employing reflected UDP amplification are regularly used to disrupt networks and systems. The amplification allows one rented server to generate significant volumes of data, while the reflection hides the identity of the attacker. Consequently this is an attractive, low risk, strategy for criminals bent on vandalism and extortion. To measure the uptake of this strategy we analyse the results of running a network of honeypot UDP reflectors (median size 65 nodes) from July 2014 onwards. We explore the life cycle of attacks that use our reflectors, from the scanning phase used to detect our honeypot machines, through to their use in attacks. We see a median of 1 450 malicious scanners per day across all UDP protocols, and have recorded details of 5.18 million subsequent attacks involving in excess of 3.31 trillion packets. Using a capture-recapture statistical technique, we estimate that our reflectors can see between 85.1% and 96.6% of UDP reflection attacks over our measurement period.</p>
<hr />
<a class="header" href="#basic-shodan-commands" id="basic-shodan-commands"><h3>Basic Shodan Commands</h3></a>
<p><code>shodan count port:5683</code> is used to get all CoAP endpoints.</p>
<p><code>shodan count port:5683 country:CN</code> to get all CoAP endpoints in China.</p>
<p><code>shodan host [IP_ADDRESS_HERE]</code> to get info on a specific endpoint.</p>
<p><code>shodan search --fields ip_str,port,org,hostnames port:5683 country:CN</code> to get a list of CoAP endpoints, their specific IPs and hostnames.</p>
<p><code>shodan stats --limit 20 port:5683</code> to get some statistics CoAP endpoits out there.</p>
<p>UDP protocols are particularly vulnerable to attack.</p>
<p>There are many UDP-based protocols that are used today to perform attacks.</p>
<p>memcached protocols has an amplicifation attack of 51200</p>
<p>The table below is inspired from <a href="http://rvasec.com/slides/2018/Rand_Dennis-RVAsec_2018.pdf">Dennis Radd</a> presentation contains some common UDP protocols used on DDOS, the <strong>total number</strong> of endpoints available on Shodan (available at April 2019) out of which an unknown (to me) percentage will be open for an attack. The request size and amplification factor is taken from the presentation and from <a href="https://www.us-cert.gov/ncas/alerts/TA14-017A">CISA</a>.</p>
<p>The amplification factor means represents the effort for an attacker, for example in CoAP a request of <code>21</code> bytes without the UDP header of size can yield a response of <code>21*16= 336</code> bytes. The target for the attacker is to use the minimum effort for the maximum attack factor. An attacker who has access to a 1 Mbps link could on average reach 16 Mbps and up to 97 Mbps <em>per endpoint</em>.</p>
<table><thead><tr><th align="left"> Protocol (port)   </th><th align="right"> Request size         </th><th align="right"> Avg/Max amplification            </th><th align="right"> Numbers                      </th></tr></thead><tbody>
<tr><td align="left"> DNS (53)          </td><td align="right">                 37 b </td><td align="right">                            28/54 </td><td align="right">                   13.986.243 </td></tr>
<tr><td align="left"> NetBIOS (137)     </td><td align="right">                 50 b </td><td align="right">                            3/229 </td><td align="right">                      601.869 </td></tr>
<tr><td align="left"> SIP (5060)        </td><td align="right">                128 b </td><td align="right">                             3/19 </td><td align="right">                   15.161.110 </td></tr>
<tr><td align="left"> SNPM (161)        </td><td align="right">                 40 b </td><td align="right">                           34/553 </td><td align="right">                    2.184.406 </td></tr>
<tr><td align="left"> NTP (123)         </td><td align="right">                 12 b </td><td align="right">                           22/198 </td><td align="right">                    9.483.324 </td></tr>
<tr><td align="left"> <strong>CoAP (5683)</strong>   </td><td align="right">              <strong>21 b</strong></td><td align="right">                        <strong>16/97</strong> </td><td align="right">                  <strong>436.854</strong> </td></tr>
<tr><td align="left"> LDAP (389)        </td><td align="right">                 52 b </td><td align="right">                            45/55 </td><td align="right">                      494.276 </td></tr>
<tr><td align="left"> Memcached (11211) </td><td align="right">                 15 b </td><td align="right">                 73/51000 (<a href="http://www.senki.org/memcached-on-port-11211-udp-tcp-being-exploited/">!!</a>) </td><td align="right">                       39.785 </td></tr>
</tbody></table>
<pre><code class="language-sh">$ shodan host 120.212.XXX.XXX
120.212.XXX.XXX
Hostnames:               XXX
City:                    Nizhniy Novgorod
Country:                 Russian Federation
Organization:            OOO Trivon Networks
Updated:                 2019-04-10T11:37:35.572911
Number of open ports:    2

Ports:
     80/tcp  
   5683/udp
</code></pre>
<pre><code class="language-sh">$ shodan host 39.159.XXX.XXX
39.159.XXX.XXX
City:                    Nanchang
Country:                 China
Organization:            China Mobile Guangdong
Updated:                 2019-04-10T11:39:13.342628
Number of open ports:    1

Ports:
   5683/udp 
</code></pre>
<p>On December 2018 the paper <a href="http://i.blackhat.com/eu-18/Thu-Dec-6/eu-18-Maggi-When-Machines-Cant-Talk-wp.pdf">When Machines can't talk</a> in there the authors present</p>
<p><a href="https://tools.ietf.org/html/bcp38">BCP38</a></p>
<p>UDP Attacks are conceptually simple.
The attacker simply forges the originators IP address in what is called IP Spoofing, and sends a request with the destination IP address of the victim. All devices will send a message ...</p>
<p>All UDP-based protocols are susceptible to IP spoofing. UDP is a connectionless protocol and, as such, unlike Transmission Control Protocol (TCP), has no handshake phase, in which the two endpoints agree on a sequence number that identifies a connection. This means that if an attacker A sends a UDP packet with a spoofed source IP address B to an endpoint C, C will have no way to verify whether that packet comes from B or A. So, if the autonomous systems (ASs) adopt no specific
countermeasures against spoofing, C will have to trust the UDP packet header and act accordingly.</p>
<p>The risk of amplification was already explained in the <a href="https://tools.ietf.org/html/rfc7252#section-11.3">CoAP specification</a>.</p>
<p>IP spoofing alone only exploits the lack of authentication in UDP and, per se, is not a big issue nowadays. However, if the application layer implements a request-response protocol, the attacker A could use C as a “reflector.” C will trust the source address B, and send any response packet to B, which will accept
such a packet according to its application layer.</p>
<p>Address spoofing on the internet is harder nowadays than in the past, thanks to various countermeasures. However, as of this writing, about 17 to 22 percent of the IPv4 (Internet Protocol version 4) ASs are still susceptible to spoofing — roughly, this translates to 9 to 14 percent of the IPv4 blocks.</p>
<p>In February 2018, an amplification attack taking advantage of the Memcache service reached almost 1 terabit per second (Tbps) of bandwidth, which could easily take down any large website.</p>
<p>Services other than Memcache have been used in the past to launch other amplification attacks, the most notable ones being DNS and SSDP. As surveyed by a well-referenced research in 2014,40 there are at least 15 application protocols that can be abused for amplification attacks, and they all have two aspects in
common: They are based on UDP and are request-response-based.</p>
<p><a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/46301.pdf">Mirai Botnet</a></p>
<p>Searching CoAP records matching the “password” keyword, we found a uniform group of about 365,000 hosts, using networking devices of the same brand, responding on the CoAP port. These hosts are all mobile hotspots located in the Asia Pacific (APAC) region. Given such authentication information and given the abundance of hotspots in the region, it is easy for an attacker to connect to that network and
abuse the service to disguise their true identity</p>
<p>As we saw in the section <a href="./coapdiscovery.html">Finding your CoAP devices</a> CoAP has an in-built discovery mechanism, thus sending a <code>GET</code> request message to the <code>/.well-known/core</code> resource might show information. Indeed, for example the node in <a href="https://pastebin.com/raw/zhZv67P5">Novgorod</a> shows the available resources, examples of the expected payloads and the interaction methods. Similarly the node in <a href="https://pastebin.com/raw/CYMCFcG5">Nanchang</a> exposes network information, interfaces and all resources available, some even related to control information and the expected content-formats.</p>
<p>If we were interested which type of devices are these , it is easy to perform an <a href="https://pastebin.com/raw/rb6Q75K9">nmap scan</a>
to find out that several other TCP ports are also open, indicating that at least a portion of the devices are gateways with a dozen other services. this could lead to think that the Gateways use CoAP as signalling protocol.</p>
<p>## Solutions</p>
<p>As we other DDOS attacks, some solutions are already at hand, some outlined in <a href="https://tools.ietf.org/html/rfc4732">RFC4732</a>:</p>
<ol>
<li>That those running networks adopt <em>source IP address verification</em> (i.e., that they improve and tighten existing systems).</li>
<li>That root server operators—and those running country code
top-level domains—draw up their countermeasure policies,
respond quickly to queries, and act quickly to add servers
back into the system if the owner shows they have improved
their security.</li>
<li>ISPs should only accept DNS queries from trusted sources
(i.e., their own customers) rather than allow anyone to use
their servers.</li>
</ol>
<p>In general, network and server administrators for Internet service providers (ISPs) should use the following best practices to avoid becoming amplifier nodes:</p>
<ol>
<li>Use network flow to detect spoofed packets. (See the Mitigation section below for information on verifying spoofed traffic before blocking that traffic.)</li>
<li>Use network flow or other summarized network data to monitor for an unusual number of requests to at-risk UDP services.</li>
<li>Use network flow to detect service anomalies (e.g., bytes-per-packet and packets-per-second anomalies).</li>
</ol>
<p>In order to prevent a malware infection on an IoT device, users and administrators should take following precautions:</p>
<p>Ensure all default passwords are changed to strong passwords. Default usernames and passwords for most devices can easily be found on the Internet, making devices with default passwords extremely vulnerable.
Update IoT devices with security patches as soon as patches become available.
Disable Universal Plug and Play (UPnP) on routers unless absolutely necessary. [12]
Purchase IoT devices from companies with a reputation for providing secure devices.
Consumers should be aware of the capabilities of the devices and appliances installed in their homes and businesses. If a device comes with a default password or an open Wi-Fi connection, consumers should change the password and only allow it to operate on a home network with a secured Wi-Fi router.
Understand the capabilities of any medical devices intended for at-home use. If the device transmits data or can be operated remotely, it has the potential to be infected.
Monitor Internet Protocol (IP) port 2323/TCP and port 23/TCP for attempts to gain unauthorized control over IoT devices using the network terminal (Telnet) protocol.[13]
Look for suspicious traffic on port 48101. Infected devices often attempt to spread malware by using port 48101 to send results to the threat actor.</p>
<hr />
<p>Zdnet has just published the following article: https://www.zdnet.com/article/the-coap-protocol-is-the-next-big-thing-for-ddos-attacks/, it explains how CoAP has been used to create a DDOS attack similar to those experienced last year with Mirai. The attack generated at some point 320Gbps of data. To compare, Mirai’s attack exceeded 600 Gbps in volume, among the largest on record. The article probably gets inspiration a presentation given also today at Black Hat Europe (https://www.blackhat.com/eu-18/briefings/schedule/index.html#when-machines-cant-talk-security-and-privacy-issues-of-machine-to-machine-data-protocols-12722 )</p>
<p>The summary is that this year has seen an increase in CoAP running devices in the open, from about 30K to circa 600K devices, mostly located in China. The number was even higher before but it has steadily been decreasing for a couple of weeks. The CoAP endpoints shouldn’t be visible there, if they are publicly visible that shows already some misconfiguration on the device. These new ones not only run CoAP but also several other services  (e.g., ftp, smtp, http, telnet…), they seem to be wireless broadband q-link routers that do not use any CoAP security at all.</p>
<p>I gave a more detailed presentation to Ericsson's TEA Security Forum about this back in November, since the attack vector has been known for quite a while and I believe it could affect unsecured LWM2M clients. I am in contact with the authors of the research too and with a Q-link developer. We are also aware of this on the CoAP standardisation side at IETF, however this is mostly a deployment issue.</p>
<p>The CoAP specification already foresees such attacks; both Packet Amplification and IP-Spoofing are attacks that can happen on any UDP protocol if you don’t use any security. Needless to say, it can easily be prevented today by using some security on your devices.</p>
<hr />
<p>The time to 1 Tbit/s amplification from CoAP servers is hard to predict — it depends on how many CoAP servers are really not so constrained and can be enticed to send Mbit/s traffic to a victim.  Now it would be useful to know what the parameters of those attacks were….</p>
<hr />
<p><a href="./another10years.html">Another 10 years</a></p>
<p>The Evolution of Cyber Attacks
The Internet of Billions of Tragically Stupid Things</p>
<hr />
<p>https://tools.ietf.org/html/draft-irtf-t2trg-iot-seccons-16</p>
<hr />
<p>ejajimn@EMB-918HFH01:~$ shodan count port:5683
618662</p>
<p>Lot's of coap endpoints in china</p>
<p>https://www.shodan.io/search?query=port%3A5683</p>
<p>Actually, to be precise</p>
<p>ejajimn@EMB-918HFH01:~$ shodan count port:5683 country:CN
604640</p>
<p>An specific example:</p>
<p>ejajimn@EMB-918HFH01:~$ shodan host 112.54.90.238
112.54.90.238
Country:                 China
Organization:            China Mobile Guangdong
Updated:                 2018-09-28T06:45:17.716725
Number of open ports:    1</p>
<p>Ports:
5683/udp</p>
<hr />
<p>Starting Nmap 7.70 ( https://nmap.org ) at 2018-09-28 11:24 EEST
Initiating Parallel DNS resolution of 1 host. at 11:24
Completed Parallel DNS resolution of 1 host. at 11:24, 0.21s elapsed
Initiating SYN Stealth Scan at 11:24
Scanning 39.178.181.144 [1000 ports]
Discovered open port 5080/tcp on 39.178.181.144
Completed SYN Stealth Scan at 11:24, 20.55s elapsed (1000 total ports)
Initiating OS detection (try #1) against 39.178.181.144
Retrying OS detection (try #2) against 39.178.181.144
adjust_timeouts2: packet supposedly had rtt of -111442 microseconds.  Ignoring time.
adjust_timeouts2: packet supposedly had rtt of -111442 microseconds.  Ignoring time.
Nmap scan report for 39.178.181.144
Host is up (0.28s latency).
Not shown: 986 closed ports
PORT      STATE    SERVICE
21/tcp    filtered ftp
23/tcp    filtered telnet
25/tcp    filtered smtp
53/tcp    filtered domain
80/tcp    filtered http
139/tcp   filtered netbios-ssn
445/tcp   filtered microsoft-ds
993/tcp   filtered imaps
5060/tcp  filtered sip
5080/tcp  open     onscreen
5555/tcp  filtered freeciv
8080/tcp  filtered http-proxy
12345/tcp filtered netbus
49152/tcp filtered unknown
Device type: WAP|general purpose|switch|storage-misc|remote management|firewall
Running (JUST GUESSING): AVM embedded (87%), Linksys embedded (87%), Netgear embedded (87%), Linux 2.6.X (85%), Extreme Networks ExtremeXOS 12.X (85%), Western Digital embedded (85%), Supermicro embedded (85%), WatchGuard Fireware 11.X (85%)
OS CPE: cpe:/h:avm:fritz%21box_fon_wlan_7050 cpe:/h:linksys:wag200g cpe:/h:netgear:dg834gt cpe:/o:linux:linux_kernel:2.6.29 cpe:/o:extremenetworks:extremexos:12.5.4 cpe:/o:linux:linux_kernel:2.6.17.14 cpe:/o:watchguard:fireware:11.3
Aggressive OS guesses: AVM FRITZ!Box FON WLAN 7050, Linksys WAG200G, or Netgear DG834GT wireless broadband router (87%), Linux 2.6.29 (85%), Linux 2.6.8 (x86) (85%), Extreme Networks ExtremeXOS 12.5.4 (85%), Western Digital MyBook World Edition 2 NAS device (Linux 2.6.17.14) (85%), Supermicro IPMI remote management (85%), WatchGuard firewall (Fireware 11.3) (85%)
No exact OS matches for host (test conditions non-ideal).
Uptime guess: 0.016 days (since Fri Sep 28 11:01:04 2018)
TCP Sequence Prediction: Difficulty=201 (Good luck!)
IP ID Sequence Generation: All zeros</p>
<p>Read data files from: /usr/local/bin/../share/nmap
OS detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 27.05 seconds
Raw packets sent: 1134 (54.936KB) | Rcvd: 1039 (41.900KB)</p>
<hr />
<a class="header" href="#most-likely-some-router-with-iot-gateway-function" id="most-likely-some-router-with-iot-gateway-function"><h2>Most likely some router with iot gateway function</h2></a>
<p>Jaime Jiménez, [7 Dec 2018 at 12:39:13]:
There was a presentation yesterday at Black Hat Europe on the issue. I contacted the authors before, will do again.</p>
<p>I was thinking of writing a blog post</p>
<p>or something light</p>
<p>what could be the right venue? my blog?</p>
<p>Specially clarifying that UDP+NOSEC is a bad idea</p>
<hr />
<p>Jaime Jiménez, [1 Oct 2018 at 23:16:33]:
i'd love to know of any other tool that has that kind of info. In order to figure out about exiting CoAP endpoints.</p>
<p>600k devices is a low estimate</p>
<p>Carsten Bormann, [1 Oct 2018 at 23:17:42]:
We won't see most tradfri controllers</p>
<p>You'd have to do lots of market research on platforms like Bosch to find the firewalled ones</p>
<p>I've heard industry research outfits are good at that :-)</p>
<hr />
<p>https://www.us-cert.gov/ncas/bulletins/SB19-077
https://nvd.nist.gov/vuln/detail/CVE-2019-9750
https://jira.iotivity.org/browse/IOT-3267
https://nvd.nist.gov/vuln-metrics/cvss/v2-calculator?version=2&amp;name=CVE-2019-9750&amp;vector=(AV:N/AC:L/Au:N/C:N/I:P/A:P)
https://www.wirehive.com/thoughts/growth-amplified-udp-reflection-ddos-attacks/
https://www.secplicity.org/2018/06/14/how-udp-amplification-is-taking-ddos-attacks-to-the-next-level/
iotivity -- iotivity    In IoTivity through 1.3.1, the CoAP server interface can be used for Distributed Denial of Service attacks using source IP address spoofing and UDP-based traffic amplification. The reflected traffic is 6 times bigger than spoofed requests. This occurs because the construction of a &quot;4.01 Unauthorized&quot; response is mishandled. NOTE: the vendor states &quot;While this is an interesting attack, there is no plan for maintainer to fix, as we are migrating to IoTivity Lite.&quot;</p>
<hr />
<p>Speaking of network operation, we are seeing some stirrings of change, but it appears to be a rather conservative area, and adoption of new network management tools and practices takes time.</p>
<p>The Internet converged on using the Simple Network Management Protocol (SNMP) a quarter of a century ago, and despite its security weaknesses, its inefficiency, its incredibly irritating use of ASN.1, and its use in sustaining some forms of DDOS attacks, it still enjoys widespread use. But SNMP is only a network monitoring protocol, not a network configuration protocol, as anyone who has attempted to use SNMP write operations can attest.</p>
<p>The more recent Netconf and YANG efforts are attempting to pull this area of configuration management into something a little more usable than expect scripts driving CLI interfaces on switches. At the same time, we are seeing orchestration tools such as Ansible, Chef, NAPALM and SALT enter the network operations space, permitting the orchestration of management tasks over thousands of individual components. These network operations management tools are welcome steps forward to improve the state of automated network management, but it’s still far short of a desirable endpoint.</p>
<p>In the same time period as we appear to have advanced the state of automated control systems to achieve the driverless autonomous car, the task of fully automated network management appears to have fallen way short of the desired endpoint. Surely it must be feasible to feed an adaptive autonomous control system with the network’s infrastructure and available resources, and allow the control system to monitor the network and modify the operating parameters of network components to continuously meet the network’s service level objectives? Where’s the driverless car for driving networks? Maybe the next ten years might get us there.</p>
<ul>
<li>The Evolution of Cyber Attacks</li>
</ul>
<p>At the same time as we have seen announcements of ever increasing network capacity within the Internet we’ve seen a parallel set of announcements that note new records in the aggregate capacity of Denial of Service attacks. The current peak volume is an attack of some 1.7Tbps of malicious traffic.</p>
<p>Attacks are now commonplace. Many of them are brutally simple, relying on a tragically large pool of potential zombie devices that are readily subverted and co-opted to assist in attacks. The attacks are often simple forms of attack, such as UDP reflection attacks where a simple UDP query generates a large response. The source address of the query is forged to be the address of the intended attack victim, and not much more need be done. A small query stream can result in a massive attack. UDP protocols such as SNMP, NTP, the DNS and memcache have been used in the past and doubtless will be used again.</p>
<p>Why can’t we fix this? We’ve been trying for decades, and we just can’t seem to get ahead of the attacks. Advice to network operators to prevent the leakage of packets with forged source addresses, RFC 2827, was published in two decades ago in 1998. Yet massive UDP-based attacks with forged source addresses persist all the way through today. Aged computer systems with known vulnerabilities continued to be connected to the Internet and are readily transformed into attack bots.</p>
<p>The picture of attacks is also becoming more ominous. Previously attributed to ‘hackers’ it was quickly realised that a significant component of these hostile attacks had criminal motivations. The progression from criminal actors to state-based actors is also entirely predictable, and we are seeing an escalation of this cyber warfare arena with the investment in various forms of exploitation of vulnerabilities being seen as part of a set of desirable national capabilities.</p>
<p>It appears that a major problem here is that collectively we are unwilling to make any substantial investment in effective defence or deterrence. The systems that we use on the Internet are overly trusting to the point of irrational credulity. For example, the public key certification system used to secure web-based transactions is repeatedly demonstrated to be entirety untrustworthy, yet that’s all we trust. Personal data is continually breached and leaked, yet all we seem to want to do is increase the number and complexity of regulations rather than actually use better tools that would effectively protect users.</p>
<p>The larger picture of hostile attack is not getting any better. Indeed, it’s getting very much worse. If any enterprise has a business need to maintain a service that is always available for use, then any form of in-house provisioning is just not enough to be able to withstand attack. These days only a handful of platforms are able to offer resilient services, and even then it’s unclear whether they could withstand the most extreme of attacks. There is a constant background level of scanning and probing going on in the network, and any form of visible vulnerability is ruthlessly exploited. One could describe today’s Internet as a toxic wasteland, punctuated with the occasional heavily defended citadel. Those who can afford to locate their services within these citadels enjoy some level of respite from this constant profile of hostile attack, while all others are forced to try and conceal themselves from the worst of this toxic environment, while at the same time aware that they will be completely overwhelmed by any large scale attack.</p>
<p>It’s a sobering through that about one half of the world’s population are now part of this digital environment. A more sobering thought is that many of today’s control systems, such as power generation and distribution, water distribution, and road traffic control systems are exposed to the Internet. Perhaps even more of a worry is the increasing use of the Internet in automated systems that include various life support functions. The consequences of massive failure of these systems in the face of a sustained and damaging attack cannot be easily imagined.</p>
<ul>
<li>The Internet of Billions of Tragically Stupid Things</li>
</ul>
<p>What makes this scenario even more depressing is the portent of the so-called Internet of Things.</p>
<p>In those circles where Internet prognostications abound and policy makers flock to hear grand visions of the future, we often hear about the boundless future represented by this “Internet of Things. This phrase encompasses some decades of the computing industry’s transition from computers as esoteric pieces of engineering affordable only by nations, to mainframes, desktops, laptops, handhelds, and now wrist computers. Where next? In the vision of the Internet of Things we are going to expand the Internet beyond people and press on with using billions of these chattering devices in every aspect of our world.</p>
<p>What do we know about the “things” that are already connected to the Internet?</p>
<p>Some of them are not very good. In fact some of them are just plain stupid. And this stupidity is toxic, in that their sometime inadequate models of operation and security affects others in potentially malicious ways. Doubtless if such devices were constantly inspected and managed we might see evidence of aberrant behaviour and correct it. But these are unmanaged devices that are all but invisible. There are the controller for a web camera, the so-called “smart” thin in a smart television, or what controls anything from a washing machine to a goods locomotive. Nobody is looking after these devices.</p>
<p>When we think of an Internet of Things we think of a world of weather stations, web cams, “smart” cars, personal fitness monitors and similar. But what we tend to forget is that all of these devices are built upon layers of other people’s software that is assembled into a product at the cheapest possible price point. It may be disconcerting to realise that the web camera you just installed has a security model that can be summarised with the phrase: “no security at all”, and its actually offering a view of your house to the entire Internet. It may be slightly more disconcerting to realise that your electronic wallet is on a device that is using a massive compilation of open source software of largely unknown origin, with a security model that is not completely understood, but appears to be susceptible to be coerced into being a “yes, take all you want”.</p>
<p>It would be nice to think that we’ve stopped making mistakes in code, and from now on our software in our things will be perfect. But that’s hopelessly idealistic. It’s just not going to happen. Software will not be perfect. It will continue to have vulnerabilities. It would be nice to think that this Internet of Things is shaping up as a market where quality matters, and consumers will select a more expensive product even though its functional behaviour is identical to a cheaper product that has not been robustly tested for basic security flaws. But that too is hopelessly naive.</p>
<p>The Internet of Things will continue to be a market place where the compromises between price and quality will continue to push us on to the side of cheap rather than secure. What’s going to stop us from further polluting our environment with a huge and diverse collection of programmed unmanaged devices with inbuilt vulnerabilities that will be all too readily exploited? What can we do to make this world of these stupid cheap toxic things less stupid and less toxic? Workable answers to this question have not been found so far.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="udpddos.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="reading.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="udpddos.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="reading.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
